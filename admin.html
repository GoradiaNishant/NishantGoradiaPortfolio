<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- SEO Meta Tags for Admin (No Index) -->
    <title>Portfolio Admin Dashboard</title>
    <meta name="title" content="Portfolio Admin Dashboard">
    <meta name="description" content="Administrative dashboard for portfolio management">
    <meta name="robots" content="noindex, nofollow">
    <meta name="author" content="Mobile Developer Portfolio">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Portfolio Admin Dashboard">
    <meta property="og:description" content="Administrative dashboard for portfolio management">
    <meta property="og:site_name" content="Mobile Developer Portfolio">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#4f46e5">
    <meta name="msapplication-TileColor" content="#4f46e5">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="//www.gstatic.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="firebase-config.js?v=1"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .form-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 1rem;
            color: #4f46e5;
            font-weight: 500;
        }
        
        /* Reorder mode styles */
        .reorder-mode .timeline-item {
            cursor: move;
            transition: all 0.2s ease;
        }
        
        .reorder-mode .timeline-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .drag-handle {
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .drag-handle:hover {
            opacity: 1;
        }
        
        .sortable-ghost {
            opacity: 0.5;
        }
        
        .sortable-chosen {
            transform: rotate(2deg);
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading admin panel...</div>
    </div>
    
    <!-- Header -->
    <header class="bg-indigo-600 text-white py-4 sm:py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
                <h1 class="text-2xl sm:text-3xl font-bold">Portfolio Admin Dashboard</h1>
                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                    <span id="userEmail" class="text-sm text-white"></span>
                    <div class="flex space-x-2 sm:space-x-4">
                        <button id="logoutBtn" class="bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition duration-300 text-sm">Logout</button>
                        <a href="index.html" class="bg-white text-indigo-600 px-3 sm:px-4 py-2 rounded-lg font-semibold hover:bg-indigo-100 transition duration-300 text-sm">View Portfolio</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
        <!-- Navigation Tabs -->
        <div class="mb-4 sm:mb-8">
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1 bg-white rounded-lg p-2 sm:p-1 shadow-sm">
                <button onclick="showSection('main-page')" class="tab-btn active bg-indigo-600 text-white flex-1 py-3 sm:py-2 px-4 rounded-md font-medium transition duration-300 text-sm sm:text-base">Main Page</button>
                <button onclick="showSection('projects')" class="tab-btn bg-gray-100 text-gray-700 flex-1 py-3 sm:py-2 px-4 rounded-md font-medium transition duration-300 text-sm sm:text-base">Projects</button>
                <button onclick="showSection('preview')" class="tab-btn bg-gray-100 text-gray-700 flex-1 py-3 sm:py-2 px-4 rounded-md font-medium transition duration-300 text-sm sm:text-base">Preview</button>
            </div>
        </div>

        <!-- Main Page Content Section -->
        <div id="main-page" class="section-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8">
                <!-- Hero Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Hero Section</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                            <input type="text" id="hero-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-base" placeholder="Enter your name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tagline</label>
                            <input type="text" id="hero-tagline" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="A Passionate Mobile Developer Crafting Seamless Apps">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Portfolio Title</label>
                            <input type="text" id="portfolio-title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="My Portfolio">
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">About Section</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Profile Image</label>
                            <div class="space-y-2">
                                <input type="file" id="profile-image-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <p class="text-sm text-gray-500">Or enter image URL:</p>
                                <input type="url" id="profile-image" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://example.com/profile.jpg">
                            </div>
                            <div id="profile-preview" class="mt-2 hidden">
                                <img id="profile-preview-img" class="w-20 h-20 rounded-full object-cover border-2 border-gray-200">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">About Me Text</label>
                            <textarea id="about-text" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Write your about me description..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Years of Experience</label>
                            <input type="number" id="experience-years" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="5">
                        </div>
                    </div>
                </div>

                <!-- Skills Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Skills Section</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Skills (comma separated)</label>
                            <input type="text" id="skills-list" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Swift, Kotlin, Flutter, React Native, Firebase, REST APIs, UI/UX Design, Git">
                        </div>
                    </div>
                </div>

                <!-- Career Timeline Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Career Timeline</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-700">Timeline Items</h3>
                            <div class="flex space-x-2">
                                <button onclick="addTimelineItem()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition duration-300">Add Item</button>
                                <button onclick="toggleReorderMode()" id="reorder-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">Reorder</button>
                            </div>
                        </div>
                        <div id="reorder-instructions" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                            <p class="text-blue-800 text-sm">💡 Drag and drop items to reorder them. Click "Save Order" when done.</p>
                        </div>
                        <div id="timeline-items-container" class="space-y-4">
                            <!-- Timeline items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Resume Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Resume Section</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Resume PDF URL</label>
                            <input type="url" id="resume-url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://example.com/resume.pdf">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Upload Resume PDF</label>
                            <input type="file" id="resume-file" accept=".pdf" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <p class="text-sm text-gray-500 mt-1">Upload your resume PDF file</p>
                        </div>
                    </div>
                </div>

                <!-- Contact Section -->
                <div class="form-section p-4 sm:p-6">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Contact Section</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="contact-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your.email@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                            <input type="tel" id="contact-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="+1 (234) 567-890">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn URL</label>
                            <input type="url" id="linkedin-url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://linkedin.com/in/yourprofile">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">GitHub URL</label>
                            <input type="url" id="github-url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://github.com/yourprofile">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="mt-6 sm:mt-8 text-center">
                <button onclick="saveMainPageContent()" class="w-full sm:w-auto bg-indigo-600 text-white px-6 sm:px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">Save Main Page Content</button>
            </div>
        </div>

        <!-- Projects Section -->
        <div id="projects" class="section-content hidden">
            <div class="form-section p-4 sm:p-6 mb-6 sm:mb-8">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Add New Project</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                        <input type="text" id="project-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Task Manager App">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project Image</label>
                        <div class="space-y-2">
                            <input type="file" id="project-image-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <p class="text-sm text-gray-500">Or enter image URL:</p>
                            <input type="url" id="project-image" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://example.com/project-image.jpg">
                        </div>
                        <div id="project-preview" class="mt-2 hidden">
                            <img id="project-preview-img" class="w-32 h-20 rounded object-cover border-2 border-gray-200">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Short Description</label>
                        <input type="text" id="project-description" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="A productivity app built with Flutter...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tech Stack (comma separated)</label>
                        <input type="text" id="project-tech" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Flutter, Dart, Firebase">
                    </div>
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Detailed Description</label>
                        <textarea id="project-detail-description" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Detailed project description for the detail page..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Development Duration</label>
                        <input type="text" id="project-duration" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="3 months">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Play URL</label>
                        <input type="url" id="project-demo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://play.google.com/store/apps/details?id=com.example.app">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">App Store URL</label>
                        <input type="url" id="project-source" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://apps.apple.com/app/id123456789">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">App Store Rating (1-5)</label>
                        <input type="number" id="project-rating" min="1" max="5" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="4.8">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Active Users</label>
                        <input type="text" id="project-users" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10K+">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">User Retention</label>
                        <input type="text" id="project-retention" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="95%">
                    </div>
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Key Features (one per line)</label>
                        <textarea id="project-features" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Task creation and categorization&#10;Smart reminders and notifications&#10;Cross-device synchronization&#10;Progress tracking and analytics&#10;Offline functionality"></textarea>
                    </div>
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Challenges & Solutions (one per line, format: Challenge|Solution)</label>
                        <textarea id="project-challenges" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Real-time sync across devices|Used Firebase Firestore with offline persistence&#10;UI for different screen sizes|Implemented responsive design patterns&#10;Performance optimization|Efficient background processing"></textarea>
                    </div>
                    
                    <!-- Technical Implementation Section -->
                    <div class="lg:col-span-2">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Technical Implementation</h3>
                    </div>
                    
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tech Stack Details (one per line, format: Technology|Description)</label>
                        <textarea id="project-tech-stack" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Frontend Framework|Flutter for cross-platform development&#10;Programming Language|Dart for mobile app development&#10;Backend Services|Firebase for authentication and database&#10;Database|Cloud Firestore for real-time data sync&#10;Authentication|Firebase Auth for user management&#10;State Management|Provider for app state management"></textarea>
                    </div>
                    
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Development Process (one per line, format: Step|Description)</label>
                        <textarea id="project-development-process" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Research & Planning|Conducted user research, defined requirements, and created project roadmap&#10;UI/UX Design|Created wireframes, mockups, and interactive prototypes&#10;Development|Implemented core features using Flutter and Firebase integration&#10;Testing|Comprehensive testing across multiple devices and platforms&#10;Deployment|Published to Google Play Store and App Store"></textarea>
                    </div>
                    
                    <!-- Screenshots Section -->
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Screenshots</label>
                        <div class="space-y-4">
                            <!-- Screenshot Upload Area -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload Screenshot Image</label>
                                        <input type="file" id="screenshot-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <p class="text-sm text-gray-500 mt-1">Upload image file (JPG, PNG, WebP)</p>
                                    </div>
                                    <div class="text-gray-500">OR</div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Screenshot URL</label>
                                        <input type="url" id="screenshot-url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://example.com/screenshot.jpg">
                                        <p class="text-sm text-gray-500 mt-1">Enter image URL</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Screenshot Title</label>
                                        <input type="text" id="screenshot-title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Home Screen">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                        <textarea id="screenshot-description" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Brief description of the screenshot"></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Orientation</label>
                                        <select id="screenshot-orientation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="auto">Auto-detect (recommended)</option>
                                            <option value="portrait">Portrait (Mobile)</option>
                                            <option value="landscape">Landscape (Tablet/Desktop)</option>
                                        </select>
                                        <p class="text-sm text-gray-500 mt-1">Choose orientation or let the system auto-detect from image dimensions</p>
                                    </div>
                                    <button type="button" onclick="addScreenshot()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300">
                                        Add Screenshot
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Screenshots Preview -->
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-2">Current Screenshots (Drag to reorder)</h4>
                                <div id="screenshots-preview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <!-- Screenshots will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 text-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <button onclick="testFields()" class="w-full sm:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">Test Fields</button>
                    <button onclick="addProject()" class="w-full sm:w-auto bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300">Add Project</button>
                    <button onclick="cancelEdit()" id="cancel-edit-btn" class="w-full sm:w-auto bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition duration-300 hidden">Cancel Edit</button>
                </div>
            </div>

            <!-- Existing Projects List -->
            <div class="form-section p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 space-y-3 sm:space-y-0">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Existing Projects</h2>
                    <button onclick="loadProjects()" class="bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700">Refresh Projects</button>
                </div>
                <div id="projects-list" class="space-y-4">
                    <!-- Projects will be loaded here -->
                </div>
            </div>


        </div>

        <!-- Preview Section -->
        <div id="preview" class="section-content hidden">
            <div class="form-section p-4 sm:p-6">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">Preview Changes</h2>
                <div class="text-center">
                    <p class="text-gray-600 mb-4">Click the button below to preview your portfolio with the current changes:</p>
                    <a href="index.html" target="_blank" class="bg-indigo-600 text-white px-6 sm:px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">Open Portfolio Preview</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Show loading overlay
        function showLoading(message = 'Loading...') {
            const overlay = document.getElementById('loading-overlay');
            const loadingText = overlay.querySelector('.loading-text');
            loadingText.textContent = message;
            overlay.style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                overlay.style.opacity = '1';
            }, 300);
        }

        // Authentication check
        firebase.auth().onAuthStateChanged(function(user) {
            if (!user) {
                // User is not logged in, show login prompt instead of redirect
                document.body.innerHTML = `
                    <div class="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div class="max-w-md w-full space-y-8 text-center">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900">Admin Access Required</h2>
                                <p class="mt-2 text-sm text-gray-600">You need to be logged in to access the admin panel.</p>
                            </div>
                            <div class="space-y-4">
                                <a href="login.html" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Go to Login
                                </a>
                                <a href="index.html" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Back to Portfolio
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // User is logged in, show their email
                document.getElementById('userEmail').textContent = user.email;
                console.log('✅ User authenticated:', user.email);
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                await firebase.auth().signOut();
                console.log('✅ Logout successful');
                window.location.href = 'login.html';
            } catch (error) {
                console.error('❌ Logout error:', error);
                alert('Error logging out. Please try again.');
            }
        });

        // Tab functionality
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Add active class to clicked tab
            event.target.classList.add('active', 'bg-indigo-600', 'text-white');
            event.target.classList.remove('bg-gray-100', 'text-gray-700');
        }

        // Initialize tabs on page load
        function initializeTabs() {
            // Show main-page section by default
            document.getElementById('main-page').classList.remove('hidden');
            document.getElementById('projects').classList.add('hidden');
            document.getElementById('preview').classList.add('hidden');
        }

        // Save main page content
        async function saveMainPageContent() {
            showLoading('Saving portfolio data...');
            
            try {
                // Get uploaded image data if available
                const profileImageData = localStorage.getItem('profile-preview_data');
                
                            // Get timeline items
            const timelineItems = [];
            const timelineContainers = document.querySelectorAll('.timeline-item');
            timelineContainers.forEach(container => {
                const item = {
                    period: container.querySelector('.timeline-period').value,
                    title: container.querySelector('.timeline-title').value,
                    company: container.querySelector('.timeline-company').value,
                    description: container.querySelector('.timeline-description').value,
                    technologies: container.querySelector('.timeline-technologies').value
                };
                timelineItems.push(item);
            });

            const data = {
                heroName: document.getElementById('hero-name').value,
                heroTagline: document.getElementById('hero-tagline').value,
                portfolioTitle: document.getElementById('portfolio-title').value,
                profileImage: profileImageData || document.getElementById('profile-image').value,
                aboutText: document.getElementById('about-text').value,
                experienceYears: document.getElementById('experience-years').value,
                skillsList: document.getElementById('skills-list').value,
                contactEmail: document.getElementById('contact-email').value,
                contactPhone: document.getElementById('contact-phone').value,
                linkedinUrl: document.getElementById('linkedin-url').value,
                githubUrl: document.getElementById('github-url').value,
                resumeUrl: document.getElementById('resume-url').value,
                careerTimeline: timelineItems
            };

                // Save to Firebase
                const success = await FirebaseDB.savePortfolioData(data);
                
                if (success) {
                    alert('Main page content saved successfully to Firebase!');
                } else {
                    alert('Error saving content. Please try again.');
                }
            } catch (error) {
                console.error('❌ Error saving portfolio data:', error);
                alert('Error saving content. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Test fields function
        function testFields() {
            console.log('🧪 Testing field capture...');
            
            const techStackField = document.getElementById('project-tech-stack');
            const developmentProcessField = document.getElementById('project-development-process');
            
            console.log('🔍 Tech Stack field element:', techStackField);
            console.log('🔍 Development Process field element:', developmentProcessField);
            
            if (techStackField) {
                console.log('✅ Tech Stack field found');
                console.log('🔍 Tech Stack field value:', techStackField.value);
                console.log('🔍 Tech Stack field type:', typeof techStackField.value);
                console.log('🔍 Tech Stack field length:', techStackField.value.length);
            } else {
                console.log('❌ Tech Stack field NOT found');
            }
            
            if (developmentProcessField) {
                console.log('✅ Development Process field found');
                console.log('🔍 Development Process field value:', developmentProcessField.value);
                console.log('🔍 Development Process field type:', typeof developmentProcessField.value);
                console.log('🔍 Development Process field length:', developmentProcessField.value.length);
            } else {
                console.log('❌ Development Process field NOT found');
            }
            
            // Test creating project object
            const testProject = {
                techStack: techStackField ? techStackField.value : 'FIELD_NOT_FOUND',
                developmentProcess: developmentProcessField ? developmentProcessField.value : 'FIELD_NOT_FOUND'
            };
            
            console.log('🧪 Test project object:', testProject);
        }

        // Add new project
        async function addProject() {
            showLoading('Adding project...');
            
            try {
                // Get uploaded project image data if available
                const projectImageData = localStorage.getItem('project-preview_data');
                
                // Get screenshots from the preview area
                const screenshots = getScreenshotsFromPreview();

                // Capture field values first
                const techStackValue = document.getElementById('project-tech-stack').value;
                const developmentProcessValue = document.getElementById('project-development-process').value;
                
                console.log('🔍 Raw field values:');
                console.log('Tech Stack field value:', techStackValue);
                console.log('Development Process field value:', developmentProcessValue);
                console.log('Tech Stack field type:', typeof techStackValue);
                console.log('Development Process field type:', typeof developmentProcessValue);
                
                const project = {
                    name: document.getElementById('project-name').value,
                    image: projectImageData || document.getElementById('project-image').value,
                    description: document.getElementById('project-description').value,
                    tech: document.getElementById('project-tech').value,
                    detailDescription: document.getElementById('project-detail-description').value,
                    duration: document.getElementById('project-duration').value,
                    demo: document.getElementById('project-demo').value,
                    source: document.getElementById('project-source').value,
                    rating: document.getElementById('project-rating').value,
                    users: document.getElementById('project-users').value,
                    retention: document.getElementById('project-retention').value,
                    features: document.getElementById('project-features').value,
                    challenges: document.getElementById('project-challenges').value,
                    techStack: techStackValue,
                    developmentProcess: developmentProcessValue,
                    screenshots: screenshots
                };

                // Debug: Check if technical data is captured
                console.log('🔍 Checking technical data capture:');
                console.log('Tech Stack field value:', document.getElementById('project-tech-stack').value);
                console.log('Development Process field value:', document.getElementById('project-development-process').value);
                console.log('Tech Stack in project object:', project.techStack);
                console.log('Development Process in project object:', project.developmentProcess);
                console.log('🔍 Tech Stack field element:', document.getElementById('project-tech-stack'));
                console.log('🔍 Development Process field element:', document.getElementById('project-development-process'));
                console.log('🔍 Full project object being sent to Firebase:', JSON.stringify(project, null, 2));

                // Add to Firebase
                const success = await FirebaseDB.addProject(project);
                
                if (success) {
                    // Clear form
                    clearProjectForm();
                    
                    // Refresh projects list
                    loadProjects();
                    
                    alert('Project added successfully to Firebase!');
                } else {
                    alert('Error adding project. Please try again.');
                }
            } catch (error) {
                console.error('❌ Error adding project:', error);
                alert('Error adding project. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Clear project form
        function clearProjectForm() {
            document.getElementById('project-name').value = '';
            document.getElementById('project-image').value = '';
            document.getElementById('project-description').value = '';
            document.getElementById('project-tech').value = '';
            document.getElementById('project-detail-description').value = '';
            document.getElementById('project-duration').value = '';
            document.getElementById('project-demo').value = '';
            document.getElementById('project-source').value = '';
            document.getElementById('project-rating').value = '';
            document.getElementById('project-users').value = '';
            document.getElementById('project-retention').value = '';
            document.getElementById('project-features').value = '';
            document.getElementById('project-challenges').value = '';
            document.getElementById('project-tech-stack').value = '';
            document.getElementById('project-development-process').value = '';
            
            // Clear screenshots
            clearScreenshots();
            
            // Clear project image preview
            document.getElementById('project-image-file').value = '';
            document.getElementById('project-preview').classList.add('hidden');
            localStorage.removeItem('project-preview_data');
            
            // Reset button to add state
            resetAddButton();
        }

        // Load existing projects
        async function loadProjects() {
            const projects = await FirebaseDB.getProjects();
            const projectsList = document.getElementById('projects-list');
            
            console.log('Loading projects from Firebase:', projects);
            console.log('Projects list element:', projectsList);
            
            projectsList.innerHTML = '';
            
            if (projects.length === 0) {
                projectsList.innerHTML = '<p class="text-gray-500 text-center py-4">No projects found. Add your first project above!</p>';
                return;
            }
            
            projects.forEach((project, index) => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'border border-gray-200 rounded-lg p-4';
                projectDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-lg">${project.name}</h3>
                            <p class="text-gray-600">${project.description}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editProject(${index})" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Edit</button>
                            <button onclick="deleteProject(${index})" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">Delete</button>
                        </div>
                    </div>
                `;
                projectsList.appendChild(projectDiv);
            });
        }

        // Edit project
        async function editProject(index) {
            const projects = await FirebaseDB.getProjects();
            const project = projects[index];
            
            if (project) {
                // Store the current editing index
                window.currentEditingIndex = index;
                
                // Populate form fields with project data
                document.getElementById('project-name').value = project.name || '';
                document.getElementById('project-image').value = project.image || '';
                document.getElementById('project-description').value = project.description || '';
                document.getElementById('project-tech').value = project.tech || '';
                document.getElementById('project-detail-description').value = project.detailDescription || '';
                document.getElementById('project-duration').value = project.duration || '';
                document.getElementById('project-demo').value = project.demo || '';
                document.getElementById('project-source').value = project.source || '';
                document.getElementById('project-rating').value = project.rating || '';
                document.getElementById('project-users').value = project.users || '';
                document.getElementById('project-retention').value = project.retention || '';
                document.getElementById('project-features').value = project.features || '';
                document.getElementById('project-challenges').value = project.challenges || '';
                document.getElementById('project-tech-stack').value = project.techStack || '';
                document.getElementById('project-development-process').value = project.developmentProcess || '';
                
                // Load screenshots
                loadScreenshotsToPreview(project.screenshots || []);
                
                // Show project image preview if it's a data URL
                if (project.image && project.image.startsWith('data:image')) {
                    document.getElementById('project-preview-img').src = project.image;
                    document.getElementById('project-preview').classList.remove('hidden');
                    localStorage.setItem('project-preview_data', project.image);
                } else {
                    document.getElementById('project-preview').classList.add('hidden');
                }
                
                // Change the add button to update button
                const addButton = document.querySelector('button[onclick="addProject()"]');
                addButton.textContent = 'Update Project';
                addButton.onclick = function() { updateProject(index); };
                addButton.className = 'bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-700 transition duration-300';
                
                // Show cancel button
                document.getElementById('cancel-edit-btn').classList.remove('hidden');
                
                // Scroll to the form
                document.querySelector('#projects .form-section').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Update project
        async function updateProject(index) {
            // Get uploaded project image data if available
            const projectImageData = localStorage.getItem('project-preview_data');
            
            // Get screenshots from the preview area
            const screenshots = getScreenshotsFromPreview();
            
            // Capture field values first
            const techStackValue = document.getElementById('project-tech-stack').value;
            const developmentProcessValue = document.getElementById('project-development-process').value;
            
            const project = {
                name: document.getElementById('project-name').value,
                image: projectImageData || document.getElementById('project-image').value,
                description: document.getElementById('project-description').value,
                tech: document.getElementById('project-tech').value,
                detailDescription: document.getElementById('project-detail-description').value,
                duration: document.getElementById('project-duration').value,
                demo: document.getElementById('project-demo').value,
                source: document.getElementById('project-source').value,
                rating: document.getElementById('project-rating').value,
                users: document.getElementById('project-users').value,
                retention: document.getElementById('project-retention').value,
                features: document.getElementById('project-features').value,
                challenges: document.getElementById('project-challenges').value,
                techStack: techStackValue,
                developmentProcess: developmentProcessValue,
                screenshots: screenshots
            };

            // Update in Firebase
            const success = await FirebaseDB.updateProject(index, project);
            
            if (success) {
                // Clear form and reset button
                clearProjectForm();
                resetAddButton();
                
                // Clear editing index
                window.currentEditingIndex = null;
                
                // Refresh projects list
                loadProjects();
                
                alert('Project updated successfully in Firebase!');
            } else {
                alert('Error updating project. Please try again.');
            }
        }

        // Cancel edit and return to add mode
        function cancelEdit() {
            // Clear the form
            clearProjectForm();
            
            // Reset button to add state
            resetAddButton();
            
            // Hide cancel button
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            
            // Clear editing index
            window.currentEditingIndex = null;
            
            // Scroll to top of form
            document.querySelector('#projects .form-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Reset add button to original state
        function resetAddButton() {
            const addButton = document.querySelector('button[onclick="updateProject()"]') || document.querySelector('button[onclick*="Project"]');
            if (addButton) {
                addButton.textContent = 'Add Project';
                addButton.onclick = function() { addProject(); };
                addButton.className = 'bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300';
            }
            
            // Hide cancel button
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        // Delete project
        async function deleteProject(index) {
            if (confirm('Are you sure you want to delete this project?')) {
                const success = await FirebaseDB.deleteProject(index);
                if (success) {
                    loadProjects();
                    alert('Project deleted successfully from Firebase!');
                } else {
                    alert('Error deleting project. Please try again.');
                }
            }
        }

        // Handle file uploads and image previews
        function handleImageUpload(fileInput, previewId, previewImgId) {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    const previewImg = document.getElementById(previewImgId);
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                    
                    // Store the image data in localStorage
                    localStorage.setItem(`${previewId}_data`, e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        // Load image previews from localStorage
        function loadImagePreviews() {
            const profileData = localStorage.getItem('profile-preview_data');
            const projectData = localStorage.getItem('project-preview_data');
            
            if (profileData) {
                document.getElementById('profile-preview-img').src = profileData;
                document.getElementById('profile-preview').classList.remove('hidden');
            }
            
            if (projectData) {
                document.getElementById('project-preview-img').src = projectData;
                document.getElementById('project-preview').classList.remove('hidden');
            }
        }

        // Timeline management functions
        function addTimelineItem() {
            const container = document.getElementById('timeline-items-container');
            const itemId = Date.now();
            
            const timelineItem = document.createElement('div');
            timelineItem.className = 'timeline-item bg-gray-50 p-4 rounded-lg border';
            timelineItem.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-semibold text-gray-700">Timeline Item</h4>
                    <button onclick="removeTimelineItem(this)" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">Remove</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Period (e.g., 2023 - Present)</label>
                        <input type="text" class="timeline-period w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="2023 - Present">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title</label>
                        <input type="text" class="timeline-title w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Senior Mobile Developer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                        <input type="text" class="timeline-company w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Tech Company Inc.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Technologies (comma separated)</label>
                        <input type="text" class="timeline-technologies w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Swift, Kotlin, Flutter">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea class="timeline-description w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Describe your role, achievements, and responsibilities..."></textarea>
                    </div>
                </div>
            `;
            
            container.appendChild(timelineItem);
            
            // If in reorder mode, add drag handle and update sortable
            if (isReorderMode && sortableInstance) {
                const newItem = container.lastElementChild;
                const dragHandle = document.createElement('div');
                dragHandle.className = 'drag-handle absolute top-2 right-2 w-6 h-6 bg-gray-200 rounded cursor-move flex items-center justify-center';
                dragHandle.innerHTML = '⋮⋮';
                dragHandle.style.zIndex = '10';
                newItem.style.position = 'relative';
                newItem.appendChild(dragHandle);
            }
        }

        function removeTimelineItem(button) {
            button.closest('.timeline-item').remove();
        }

        // Reorder functionality
        let sortableInstance = null;
        let isReorderMode = false;

        function toggleReorderMode() {
            const reorderBtn = document.getElementById('reorder-btn');
            const instructions = document.getElementById('reorder-instructions');
            const container = document.getElementById('timeline-items-container');
            
            isReorderMode = !isReorderMode;
            
            if (isReorderMode) {
                // Enable reorder mode
                reorderBtn.textContent = 'Save Order';
                reorderBtn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition duration-300';
                instructions.classList.remove('hidden');
                container.classList.add('reorder-mode');
                
                // Initialize Sortable
                sortableInstance = new Sortable(container, {
                    animation: 150,
                    ghostClass: 'bg-blue-100',
                    chosenClass: 'bg-blue-200',
                    dragClass: 'bg-blue-300',
                    onEnd: function() {
                        console.log('Timeline items reordered');
                    }
                });
                
                // Add drag handles to all timeline items
                document.querySelectorAll('.timeline-item').forEach(item => {
                    if (!item.querySelector('.drag-handle')) {
                        const dragHandle = document.createElement('div');
                        dragHandle.className = 'drag-handle absolute top-2 right-2 w-6 h-6 bg-gray-200 rounded cursor-move flex items-center justify-center';
                        dragHandle.innerHTML = '⋮⋮';
                        dragHandle.style.zIndex = '10';
                        item.style.position = 'relative';
                        item.appendChild(dragHandle);
                    }
                });
                
            } else {
                // Disable reorder mode
                reorderBtn.textContent = 'Reorder';
                reorderBtn.className = 'bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-300';
                instructions.classList.add('hidden');
                container.classList.remove('reorder-mode');
                
                // Destroy Sortable instance
                if (sortableInstance) {
                    sortableInstance.destroy();
                    sortableInstance = null;
                }
                
                // Remove drag handles
                document.querySelectorAll('.drag-handle').forEach(handle => {
                    handle.remove();
                });
            }
        }

        function loadTimelineItems(timelineData) {
            const container = document.getElementById('timeline-items-container');
            container.innerHTML = '';
            
            if (timelineData && timelineData.length > 0) {
                timelineData.forEach(item => {
                    const timelineItem = document.createElement('div');
                    timelineItem.className = 'timeline-item bg-gray-50 p-4 rounded-lg border';
                    timelineItem.innerHTML = `
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-semibold text-gray-700">Timeline Item</h4>
                            <button onclick="removeTimelineItem(this)" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">Remove</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Period (e.g., 2023 - Present)</label>
                                <input type="text" class="timeline-period w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="${item.period || ''}" placeholder="2023 - Present">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Job Title</label>
                                <input type="text" class="timeline-title w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="${item.title || ''}" placeholder="Senior Mobile Developer">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                                <input type="text" class="timeline-company w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="${item.company || ''}" placeholder="Tech Company Inc.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Technologies (comma separated)</label>
                                <input type="text" class="timeline-technologies w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="${item.technologies || ''}" placeholder="Swift, Kotlin, Flutter">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea class="timeline-description w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Describe your role, achievements, and responsibilities...">${item.description || ''}</textarea>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(timelineItem);
                });
            }
            
            // If in reorder mode, reinitialize sortable
            if (isReorderMode && sortableInstance) {
                setTimeout(() => {
                    sortableInstance.destroy();
                    sortableInstance = new Sortable(container, {
                        animation: 150,
                        ghostClass: 'bg-blue-100',
                        chosenClass: 'bg-blue-200',
                        dragClass: 'bg-blue-300',
                        onEnd: function() {
                            console.log('Timeline items reordered');
                        }
                    });
                    
                    // Add drag handles
                    document.querySelectorAll('.timeline-item').forEach(item => {
                        if (!item.querySelector('.drag-handle')) {
                            const dragHandle = document.createElement('div');
                            dragHandle.className = 'drag-handle absolute top-2 right-2 w-6 h-6 bg-gray-200 rounded cursor-move flex items-center justify-center';
                            dragHandle.innerHTML = '⋮⋮';
                            dragHandle.style.zIndex = '10';
                            item.style.position = 'relative';
                            item.appendChild(dragHandle);
                        }
                    });
                }, 100);
            }
        }

        // Handle PDF file uploads
        function handlePDFUpload(fileInput, urlInput) {
            const file = fileInput.files[0];
            if (file) {
                if (file.type === 'application/pdf') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // For PDF files, we'll store the data URL
                        // In a real application, you'd upload to a cloud storage service
                        urlInput.value = e.target.result;
                        alert('PDF uploaded successfully! The data URL has been set in the URL field.');
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Please select a PDF file.');
                    fileInput.value = '';
                }
            }
        }

        // Add event listeners for file uploads
        function setupImageUploads() {
            document.getElementById('profile-image-file').addEventListener('change', function() {
                handleImageUpload(this, 'profile-preview', 'profile-preview-img');
            });
            
            document.getElementById('project-image-file').addEventListener('change', function() {
                handleImageUpload(this, 'project-preview', 'project-preview-img');
            });
            
            // Add PDF upload listener
            document.getElementById('resume-file').addEventListener('change', function() {
                handlePDFUpload(this, document.getElementById('resume-url'));
            });
        }

        // Load saved data on page load
        window.onload = async function() {
            showLoading('Loading admin panel...');
            
            try {
                // Initialize tabs first
                initializeTabs();
                
                showLoading('Loading portfolio data...');
                const savedData = await FirebaseDB.getPortfolioData();
                
                // Populate form fields with saved data
                if (savedData.heroName) document.getElementById('hero-name').value = savedData.heroName;
                if (savedData.heroTagline) document.getElementById('hero-tagline').value = savedData.heroTagline;
                if (savedData.portfolioTitle) document.getElementById('portfolio-title').value = savedData.portfolioTitle;
                if (savedData.profileImage) {
                    document.getElementById('profile-image').value = savedData.profileImage;
                    // If it's a data URL (uploaded image), show preview
                    if (savedData.profileImage.startsWith('data:image')) {
                        document.getElementById('profile-preview-img').src = savedData.profileImage;
                        document.getElementById('profile-preview').classList.remove('hidden');
                        localStorage.setItem('profile-preview_data', savedData.profileImage);
                    }
                }
                if (savedData.aboutText) document.getElementById('about-text').value = savedData.aboutText;
                if (savedData.experienceYears) document.getElementById('experience-years').value = savedData.experienceYears;
                if (savedData.skillsList) document.getElementById('skills-list').value = savedData.skillsList;
                if (savedData.contactEmail) document.getElementById('contact-email').value = savedData.contactEmail;
                            if (savedData.contactPhone) document.getElementById('contact-phone').value = savedData.contactPhone;
            if (savedData.linkedinUrl) document.getElementById('linkedin-url').value = savedData.linkedinUrl;
            if (savedData.githubUrl) document.getElementById('github-url').value = savedData.githubUrl;
            if (savedData.resumeUrl) document.getElementById('resume-url').value = savedData.resumeUrl;
            if (savedData.careerTimeline) loadTimelineItems(savedData.careerTimeline);
                
                // Setup image uploads and load previews
                setupImageUploads();
                loadImagePreviews();
                
                // Load projects
                showLoading('Loading projects...');
                loadProjects();
                
                // Debug: Check if projects are saved
                const projects = await FirebaseDB.getProjects();
                console.log('Projects in Firebase:', projects);
                console.log('Number of projects:', projects.length);
                
                console.log('✅ Admin panel loaded successfully');
                

            } catch (error) {
                console.error('❌ Error loading admin panel:', error);
                alert('Error loading admin panel. Please refresh the page.');
            } finally {
                hideLoading();
            }
        };

        // Screenshot Management Functions
        let currentScreenshots = [];

        // Add screenshot to preview
        async function addScreenshot() {
            const fileInput = document.getElementById('screenshot-file');
            const urlInput = document.getElementById('screenshot-url');
            const titleInput = document.getElementById('screenshot-title');
            const descriptionInput = document.getElementById('screenshot-description');
            const orientationInput = document.getElementById('screenshot-orientation');

            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            const orientation = orientationInput.value;

            if (!title || !description) {
                alert('Please enter both title and description for the screenshot.');
                return;
            }

            let imageData = null;

            // Check if file is uploaded
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.type.startsWith('image/')) {
                    imageData = await convertFileToBase64(file);
                } else {
                    alert('Please select a valid image file.');
                    return;
                }
            } else if (urlInput.value.trim()) {
                // Use URL if provided
                imageData = urlInput.value.trim();
            } else {
                alert('Please either upload an image file or provide an image URL.');
                return;
            }

            const screenshot = {
                title: title,
                description: description,
                url: imageData,
                orientation: orientation === 'auto' ? null : orientation // Only store if explicitly set
            };

            currentScreenshots.push(screenshot);
            updateScreenshotsPreview();
            clearScreenshotForm();
        }

        // Convert file to base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Update screenshots preview
        function updateScreenshotsPreview() {
            const previewContainer = document.getElementById('screenshots-preview');
            previewContainer.innerHTML = '';

            currentScreenshots.forEach((screenshot, index) => {
                const screenshotDiv = document.createElement('div');
                screenshotDiv.className = 'border rounded-lg p-3 bg-white cursor-move hover:shadow-md transition-shadow';
                screenshotDiv.draggable = true;
                screenshotDiv.dataset.index = index;
                screenshotDiv.innerHTML = `
                    <div class="relative">
                        <div class="absolute top-1 left-1 bg-gray-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-75">
                            ⋮⋮
                        </div>
                        <img src="${screenshot.url}" alt="${screenshot.title}" class="w-full h-32 object-cover rounded mb-2">
                        <button onclick="removeScreenshot(${index})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600">
                            ×
                        </button>
                    </div>
                    <h5 class="font-medium text-sm">${screenshot.title}</h5>
                    <p class="text-xs text-gray-600">${screenshot.description}</p>
                `;
                
                // Add drag event listeners
                screenshotDiv.addEventListener('dragstart', handleDragStart);
                screenshotDiv.addEventListener('dragover', handleDragOver);
                screenshotDiv.addEventListener('drop', handleDrop);
                screenshotDiv.addEventListener('dragenter', handleDragEnter);
                screenshotDiv.addEventListener('dragleave', handleDragLeave);
                screenshotDiv.addEventListener('dragend', handleDragEnd);
                
                previewContainer.appendChild(screenshotDiv);
            });
            
            console.log('Screenshots preview updated with', currentScreenshots.length, 'items');
        }

        // Drag and drop functionality
        let draggedIndex = null;

        function handleDragStart(e) {
            console.log('Drag start');
            draggedIndex = parseInt(this.dataset.index);
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            if (this.classList.contains('border')) {
                this.classList.add('border-blue-500', 'border-2');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('border-blue-500', 'border-2');
        }

        function handleDrop(e) {
            e.preventDefault();
            console.log('Drop event');
            this.classList.remove('border-blue-500', 'border-2');
            
            const dropIndex = parseInt(this.dataset.index);
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                console.log('Moving from index', draggedIndex, 'to index', dropIndex);
                
                // Reorder the screenshots array
                const [movedScreenshot] = currentScreenshots.splice(draggedIndex, 1);
                currentScreenshots.splice(dropIndex, 0, movedScreenshot);
                
                // Update the preview
                updateScreenshotsPreview();
            }
        }

        function handleDragEnd(e) {
            console.log('Drag end');
            this.style.opacity = '1';
            draggedIndex = null;
        }

        // Remove screenshot
        function removeScreenshot(index) {
            currentScreenshots.splice(index, 1);
            updateScreenshotsPreview();
        }

        // Clear screenshot form
        function clearScreenshotForm() {
            document.getElementById('screenshot-file').value = '';
            document.getElementById('screenshot-url').value = '';
            document.getElementById('screenshot-title').value = '';
            document.getElementById('screenshot-description').value = '';
            document.getElementById('screenshot-orientation').value = 'auto';
        }

        // Clear all screenshots
        function clearScreenshots() {
            currentScreenshots = [];
            updateScreenshotsPreview();
        }

        // Get screenshots from preview
        function getScreenshotsFromPreview() {
            return [...currentScreenshots];
        }

        // Load screenshots to preview
        function loadScreenshotsToPreview(screenshots) {
            currentScreenshots = [...screenshots];
            updateScreenshotsPreview();
        }

        // Test function to add sample screenshots for testing drag-and-drop
        function addTestScreenshots() {
            const testScreenshots = [
                {
                    title: 'Mobile Home Screen',
                    description: 'Portrait mobile screenshot',
                    url: 'https://picsum.photos/300/600?random=1',
                    orientation: 'portrait'
                },
                {
                    title: 'Tablet Dashboard',
                    description: 'Landscape tablet screenshot',
                    url: 'https://picsum.photos/600/400?random=2',
                    orientation: 'landscape'
                },
                {
                    title: 'Desktop Settings',
                    description: 'Landscape desktop screenshot',
                    url: 'https://picsum.photos/800/450?random=3',
                    orientation: 'landscape'
                },
                {
                    title: 'Mobile Profile',
                    description: 'Portrait mobile screenshot',
                    url: 'https://picsum.photos/300/600?random=4',
                    orientation: 'portrait'
                }
            ];
            
            currentScreenshots = [...testScreenshots];
            updateScreenshotsPreview();
            console.log('Added test screenshots for drag-and-drop testing');
        }

    </script>
</body>
</html> 